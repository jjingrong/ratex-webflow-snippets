"use strict";function popupInit(){var initialTime=arguments.length>0&&arguments[0]!==undefined?arguments[0]:10000;var followUpTime=arguments.length>1&&arguments[1]!==undefined?arguments[1]:10000;var duration=arguments.length>2&&arguments[2]!==undefined?arguments[2]:5000;var popupData={};var repeatIdCheck=[];var initialTimeup;var followUpTimeup;var durationTimeUp;var appearDuration;var localStorageKey='popupIdList';var popup={popupContainerClass:'popupContainer',imageId:'imageContent',titleId:'title',nameId:'name',timeId:'time',closeId:'close'};function setup(){var hasPopupIdList=localStorage.getItem(localStorageKey)!==null&&Array.isArray(JSON.parse(localStorage.getItem(localStorageKey)));if(hasPopupIdList){repeatIdCheck=JSON.parse(localStorage.getItem(localStorageKey))}
var popupContainer=document.getElementsByClassName(popup.popupContainerClass)[0];var retreivalTimelimit=10000;var durationLimit=5000;if(!popupContainer){if(typeof initialTime!=='number'||initialTime<0){initialTime=retreivalTimelimit}
if(typeof followUpTime!=='number'||followUpTime<retreivalTimelimit){followUpTime=retreivalTimelimit}
if(typeof duration!=='number'||duration<0||duration>=followUpTime){duration=followUpTime-2000}
if(duration<durationLimit){duration=durationLimit}
appearDuration=duration;createDisplay();initialTimeup=setTimeout(function(){incomingIntervalUpdate(followUpTime);retrieveData()},initialTime)}}
function createDisplay(){var popupElement=document.createElement('div');popupElement.className=popup.popupContainerClass;popupElement.id='popupContainerOut';popupElement.innerHTML="<img id=".concat(popup.imageId," />\n       <div class='textContainer'>\n          <div class='closeContainer'>\n          <div id=").concat(popup.titleId,"></div>\n          <svg id=").concat(popup.closeId," xmlns='http://www.w3.org/2000/svg'\n          viewPort= '0 0 12 12' width='11' height='11' fill= 'none'>\n            <line x1=1 y1=11 x2= 11 y2=1 stroke=white stroke-width=2></line>\n            <line x1=1 y1=1 x2= 11 y2=11 stroke=white stroke-width=2></line>\n          </svg>\n        </div>\n       <div id=").concat(popup.nameId,"></div>\n       <div id=").concat(popup.timeId,"></div>");document.body.appendChild(popupElement);popupElement.onclick=function(e){if(e.target.id===popup.closeId){closePopup()}else{openInNewTab()}}}
function retrieveData(){var xhr=new XMLHttpRequest();xhr.open('GET','https://ratex.co/store/api/feed?limit=2',!0);xhr.addEventListener("load",function(){if(xhr.status===200){var data=JSON.parse(xhr.response);popupData.date=calTimeDiff(data.data[0].last_success);if(data.data[0].type==="PRODUCT"){popupData.title="Someone recently purchased";popupData.name=data.data[0].product.name;popupData.image=data.data[0].product.images[0];popupData.id="P".concat(data.data[0].product.id);popupData.link="https://ratex.co/home/".concat(data.data[0].product.slug,"/p/").concat(data.data[0].product.id)}else{popupData.title="Someone recently used";popupData.name=data.data[0].coupon.merchant;popupData.image="https://s3-ap-southeast-1.amazonaws.com/ratex-merchants/icons/ecommerce/".concat(data.data[0].coupon.merchant,".png");popupData.id="C".concat(data.data[0].coupon.id);popupData.link="https://ratex.co/home/shops#voucher=".concat(data.data[0].coupon.id)}
updateDisplay()}},!1);xhr.send()}
function calTimeDiff(time){var todayDate=new Date();var compareDate=new Date(time);var timeDiff=Math.abs(todayDate.getTime()-compareDate.getTime());var minutes=60*1000;var hours=minutes*60;var day=hours*24;var diffDays;if(timeDiff>minutes){diffDays="".concat(Math.ceil(timeDiff/minutes)," minutes ago")}
if(timeDiff>hours){diffDays="".concat(Math.ceil(timeDiff/hours)," hours ago")}
if(timeDiff>day){diffDays="".concat(Math.ceil(timeDiff/day)," days ago")}
return diffDays}
function updateDisplay(){if(repeatIdCheck.indexOf(popupData.id)===-1){var imageContent=document.getElementById(popup.imageId);if(imageContent){imageContent.setAttribute('alt',popupData.name);imageContent.setAttribute('src',popupData.image)}
var title=document.getElementById(popup.titleId);if(title){title.innerText=popupData.title}
var name=document.getElementById(popup.nameId);if(name){name.innerText=popupData.name}
var time=document.getElementById(popup.timeId);if(time){time.innerText=popupData.date}
var popupContainer=document.getElementsByClassName(popup.popupContainerClass)[0];if(popupContainer){popupContainer.id="popupContainerEntrance"}
repeatIdCheck.push(popupData.id);localStorage.setItem(localStorageKey,JSON.stringify(repeatIdCheck));appearDurationBeforeExit()}}
function appearDurationBeforeExit(){durationTimeUp=setTimeout(function(){var popupContainer=document.getElementsByClassName(popup.popupContainerClass)[0];if(popupContainer){popupContainer.id="popupContainerExit"}},appearDuration)}
function incomingIntervalUpdate(followUpTime){followUpTimeup=setInterval(function(){retrieveData()},followUpTime)}
function openInNewTab(){if(!!popupData.link){var win=window.open(popupData.link,'_blank');win.focus()}}
function closePopup(){var popupContainer=document.getElementsByClassName(popup.popupContainerClass)[0];if(popupContainer){popupContainer.id="popupContainerExit"}
clearTimeout(initialTimeup);clearInterval(followUpTimeup);clearTimeout(durationTimeUp)}
setup()}