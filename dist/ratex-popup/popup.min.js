"use strict";function popupInit(){var initialTime=arguments.length>0&&arguments[0]!==undefined?arguments[0]:10000;var followUpTime=arguments.length>1&&arguments[1]!==undefined?arguments[1]:10000;var duration=arguments.length>2&&arguments[2]!==undefined?arguments[2]:5000;var popupData={};var repeatIdCheck=[];var initialTimeup;var followUpTimeup;var durationTimeUp;var appearDuration;var localStorageKey='popupIdList';var popup={popupContainerClass:'popupContainer',imageId:'imageContent',titleId:'title',nameId:'name',timeId:'time',closeId:'close'};function setup(){var hasPopupIdList=localStorage.getItem(localStorageKey)!==null&&Array.isArray(JSON.parse(localStorage.getItem(localStorageKey)));if(hasPopupIdList){repeatIdCheck=JSON.parse(localStorage.getItem(localStorageKey))}
var popupContainer=document.getElementsByClassName(popup.popupContainerClass)[0];var retreivalTimelimit=10000;var durationLimit=5000;if(!popupContainer){if(typeof initialTime!=='number'||initialTime<0){initialTime=retreivalTimelimit}
if(typeof followUpTime!=='number'||followUpTime<retreivalTimelimit){followUpTime=retreivalTimelimit}
if(typeof duration!=='number'||duration<0||duration>=followUpTime){duration=followUpTime-2000}
if(duration<durationLimit){duration=durationLimit}
appearDuration=duration;createDisplay();initialTimeup=setTimeout(function(){incomingIntervalUpdate(followUpTime);retrieveData()},initialTime)}}
function createDisplay(){var popupElement=document.createElement('div');popupElement.className=popup.popupContainerClass;popupElement.id='popupContainerOut';popupElement.innerHTML="<img id="+popup.imageId+" />"+"<div class=textContainer>"+"<div class=closeContainer>"+"<div id="+popup.titleId+"></div>"+"<img src='https://raw.githubusercontent.com/rate-engineering/ratex-webflow-snippets/44ee8793cc84d126b9ecf0f36bdc9f4dd1c2bfbf/ClosePopup.svg' alt='close' id="+popup.closeId+" />"+"</div>"+"<div id="+popup.nameId+"></div>"+"<div id="+popup.timeId+"></div>";document.body.appendChild(popupElement);popupElement.onclick=function(e){if(e.target.id===popup.closeId){closePopup()}else{openInNewTab()}}}
function retrieveData(){var xhr=new XMLHttpRequest();xhr.open('GET','https://ratex.co/store/api/feed',!0);xhr.addEventListener("load",function(){if(xhr.status===200){var data=JSON.parse(xhr.response);popupData.date=calTimeDiff(data.data[0].last_success);if(data.data[0].type==="PRODUCT"){popupData.title="Someone recently purchased";popupData.name=data.data[0].product.name;popupData.image=data.data[0].product.images[0];popupData.id="P"+data.data[0].product.id.toString();popupData.link="https://ratex.co/home/"+data.data[0].product.slug+"/p/"+data.data[0].product.id}else{popupData.title="Someone recently used";popupData.name=data.data[0].coupon.merchant;popupData.image="https://s3-ap-southeast-1.amazonaws.com/ratex-merchants/icons/ecommerce/"+data.data[0].coupon.merchant+".png";popupData.id="C"+data.data[0].coupon.id.toString();popupData.link="https://ratex.co/home/shops/#voucher="+data.data[0].coupon.id}
updateDisplay()}},!1);xhr.send()}
function calTimeDiff(time){var todayDate=new Date();var compareDate=new Date(time);var timeDiff=Math.abs(todayDate.getTime()-compareDate.getTime());var minutes=60*1000;var hours=minutes*60;var day=hours*24;var diffDays;if(timeDiff>minutes){diffDays=Math.ceil(timeDiff/minutes).toString()+" minutes ago"}
if(timeDiff>hours){diffDays=Math.ceil(timeDiff/hours).toString()+" hours ago"}
if(timeDiff>day){diffDays=Math.ceil(timeDiff/day).toString()+" days ago"}
return diffDays}
function updateDisplay(){if(repeatIdCheck.indexOf(popupData.id)===-1){var imageContent=document.getElementById(popup.imageId);if(imageContent){imageContent.setAttribute('alt',popupData.name);imageContent.setAttribute('src',popupData.image)}
var title=document.getElementById(popup.titleId);if(title){title.innerText=popupData.title}
var name=document.getElementById(popup.nameId);if(name){name.innerText=popupData.name}
var time=document.getElementById(popup.timeId);if(time){time.innerText=popupData.date}
var popupContainer=document.getElementsByClassName(popup.popupContainerClass)[0];if(popupContainer){popupContainer.id="popupContainerEntrance"}
repeatIdCheck.push(popupData.id);localStorage.setItem(localStorageKey,JSON.stringify(repeatIdCheck));appearDurationBeforeExit()}}
function appearDurationBeforeExit(){durationTimeUp=setTimeout(function(){var popupContainer=document.getElementsByClassName(popup.popupContainerClass)[0];if(popupContainer){popupContainer.id="popupContainerExit"}},appearDuration)}
function incomingIntervalUpdate(followUpTime){followUpTimeup=setInterval(function(){retrieveData()},followUpTime)}
function openInNewTab(){if(!!popupData.link){var win=window.open(popupData.link,'_blank');win.focus()}}
function closePopup(){var popupContainer=document.getElementsByClassName(popup.popupContainerClass)[0];if(popupContainer){popup.id="popupContainerExit"}
clearTimeout(initialTimeup);clearInterval(followUpTimeup);clearTimeout(durationTimeUp)}
setup()}